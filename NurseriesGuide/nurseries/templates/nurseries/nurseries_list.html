{% extends 'main/base.html' %}

{% block title %}حضاناتنا{% endblock %}

{% block hero %}
<section class="">
    <div class="bg-light py-4">
        <form method="get" action="{% url 'nurseries:nurseries_list' %}" class="row align-items-center justify-content-between mt-4">
            <div class="col-md-8 d-flex flex-wrap gap-2 justify-content-center justify-content-md-start filter-buttons">
                <button type="submit" class="btn btn-dark custom-filter-btn rounded-pill">
                    <i class="fas fa-filter me-1"></i> تصفية
                </button>
        
                <div class="dropdown">
                    <select name="age" class="form-select custom-select rounded-pill" onchange="this.form.submit()">
                        <option value="">العمر</option>
                        {% for age_option in ages %}
                            <option value="{{ age_option }}" {% if age == age_option %}selected{% endif %}>{{ age_option }}</option>
                        {% endfor %}
                    </select>
                </div>
        
                <div class="dropdown">
                    <select name="city" class="form-select custom-select rounded-pill" onchange="this.form.submit()">
                        <option value="">المدينه</option>
                        {% for city_option in cities %}
                            <option value="{{ city_option }}" {% if city == city_option %}selected{% endif %}>{{ city_option }}</option>
                        {% endfor %}
                    </select>
                </div>
        
                <div class="dropdown">
                    <select name="neighborhood" class="form-select custom-select rounded-pill" onchange="this.form.submit()">
                        <option value="">الحي</option>
                        {% for neighborhood_option in neighborhoods %}
                            <option value="{{ neighborhood_option }}" {% if neighborhood == neighborhood_option %}selected{% endif %}>{{ neighborhood_option }}</option>
                        {% endfor %}
                    </select>
                </div>
        
                <div class="form-check mx-end">
                    <input type="checkbox" class="form-check-input" name="special_needs" value="1" {% if special_needs %}checked{% endif %} onchange="this.form.submit()">
                    <label class="form-check-label">ذوي احتياجات خاصة</label>
                </div>
        
                <div class="w-100"></div> <!-- Clear after the last element -->
            </div>
        
            <!-- Search Bar -->
            <div class="col-md-4 d-flex justify-content-center justify-content-md-end mt-2 mt-md-0">
                <input type="text" name="searched" value="{{ search_term }}" class="form-control me-2 rounded-pill" placeholder="بحث...">
                <button type="submit" class="btn btn-dark rounded-pill">البحث</button>
                <a href="{% url 'nurseries:nurseries_list' %}" class="btn btn-outline-secondary rounded-pill ms-2">إزالة الفلاتر</a>
            </div>
        </form>
    </div>
</section>

{% endblock %}

{% block content %}
<div class="container mt-4">
    
    

    <!-- Nurseries List -->
    <div class="row mt-4">
        {% if has_nurseries %}
            {% for nursery in nurseries %}
            <div class="col-lg-6 mb-4">
                <div class="card h-100 shadow-sm border-0 d-flex flex-lg-row">
                    <div class="col-lg-6 p-3">
                        <div class="nursery-card border rounded bg-light h-100 d-flex align-items-center justify-content-center">
                            <img src="https://placehold.co/400x300/e3e2de/787674" alt="Image of {{ nursery.name }}" class="img-fluid">
                        </div>
                    </div>
                    <div class="col-lg-6 d-flex flex-column justify-content-center p-3">
                        <h2 class="h5 mb-2">{{ nursery.name }}</h2>
                        <div class="stars">
                            {% for i in "12345" %}
                                {% if i|add:"0" <= nursery.avg_rating %}
                                    <i class="fas fa-star"></i>
                                {% elif i == nursery.avg_rating|stringformat:"d"|floatformat:1 %}
                                    <i class="fas fa-star-half-alt"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>                        
                        <p class="mb-2">{{ nursery.description|truncatewords:20 }}</p>
                        <p class="text-muted small"><i class="fas fa-map-marker-alt"></i> {{ nursery.neighborhood.city.name }} - {{ nursery.neighborhood.name }} <span class="ms-2">{{ nursery.age_group }} <i class="fas fa-child"></i></span></p>
                        <a href="{% url 'nurseries:nursery_detail' nursery.id %}" class="btn btn-dark rounded-pill">المزيد</a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <p class="text-center fs-4 text-muted">لا توجد حضانات مطابقة للبحث أو الفلاتر.</p>
            </div>
            {% endfor %}
        {% else %}
            <div class="col-12">
                <p class="text-center fs-4 text-muted">لا توجد حضانات في قاعدة البيانات.</p>
            </div>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if nurseries.has_other_pages %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            {% if nurseries.has_previous %}
            <li class="page-item">
                <a class="page-link rounded-pill" href="?{% if search_term %}searched={{ search_term }}&{% endif %}{% if age %}age={{ age }}&{% endif %}{% if city %}city={{ city }}&{% endif %}{% if neighborhood %}neighborhood={{ neighborhood }}&{% endif %}{% if special_needs %}special_needs={{ special_needs }}&{% endif %}page={{ nurseries.previous_page_number }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% endif %}
            {% for num in nurseries.paginator.page_range %}
                {% if nurseries.number == num %}
                    <li class="page-item active"><span class="page-link rounded-pill">{{ num }}</span></li>
                {% else %}
                    <li class="page-item"><a class="page-link rounded-pill" href="?{% if search_term %}searched={{ search_term }}&{% endif %}{% if age %}age={{ age }}&{% endif %}{% if city %}city={{ city }}&{% endif %}{% if neighborhood %}neighborhood={{ neighborhood }}&{% endif %}{% if special_needs %}special_needs={{ special_needs }}&{% endif %}page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            {% if nurseries.has_next %}
            <li class="page-item">
                <a class="page-link rounded-pill" href="?{% if search_term %}searched={{ search_term }}&{% endif %}{% if age %}age={{ age }}&{% endif %}{% if city %}city={{ city }}&{% endif %}{% if neighborhood %}neighborhood={{ neighborhood }}&{% endif %}{% if special_needs %}special_needs={{ special_needs }}&{% endif %}page={{ nurseries.next_page_number }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}
